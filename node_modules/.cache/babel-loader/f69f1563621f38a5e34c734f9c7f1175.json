{"remainingRequest":"C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\src\\components\\Message\\messageMain.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\src\\components\\Message\\messageMain.vue","mtime":1602243582522},{"path":"C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1597490030034},{"path":"C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\babel-loader\\lib\\index.js","mtime":1597490029689},{"path":"C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1597490030034},{"path":"C:\\Users\\tyt\\Desktop\\编程\\vscode\\华北五省\\goods_project\\node_modules\\vue-loader\\lib\\index.js","mtime":1597490040244}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport config from \"@/config/config.json\";\nimport messageApi from \"@/api/message.js\";\nimport leftMsg from \"@/components/Message/leftMsg.vue\";\nimport rightMsg from \"@/components/Message/rightMsg.vue\";\nexport default {\n  name: \"messageMain\",\n  data: function data() {\n    return {\n      refreshStatus: false,\n      userList: [],\n      chatRoom: {\n        noShow: true,\n        input: \"\",\n        list: [],\n        userName: \"\"\n      },\n      userId: sessionStorage.getItem(\"userId\")\n    };\n  },\n  methods: {\n    //上拉刷新\n    myRefresh: function myRefresh() {\n      var data = {\n        userName: this.userId\n      };\n      this.refreshStatus = !this.refreshStatus;\n      messageApi.freshMessage(data, this);\n    },\n    //进入聊天框\n    enterChat: function enterChat(item) {\n      //记录用户\n      this.chatRoom.userName = item.friendName; //生成数据\n\n      var data = {\n        friendName: item.friendName,\n        userName: this.userId\n      }; //请求历史信息\n\n      messageApi.specificMessage(data, this); //建立socket连接\n\n      messageApi.chatConnect({\n        username: this.userId,\n        password: \"\"\n      }, this);\n      this.chatRoom.noShow = !this.chatRoom.noShow;\n    },\n    leaveChat: function leaveChat() {\n      //清空消息\n      this.chatRoom.list.length = 0;\n      this.chatRoom.noShow = !this.chatRoom.noShow; //断开连接\n\n      messageApi.chatDisconnect();\n    },\n    //用户发送消息\n    send: function send() {\n      //未输入信息拦截\n      if (this.chatRoom.input === \"\") {\n        this.$notify({\n          type: \"warning\",\n          message: \"未输入任何信息\",\n          duration: 500\n        });\n        return;\n      } //加入right组件\n\n\n      this.chatRoom.list.push({\n        component: \"rightMsg\",\n        content: this.chatRoom.input\n      });\n      var data = {\n        msg: this.chatRoom.input,\n        user: this.chatRoom.userName\n      };\n      messageApi.chatSend(data); //清空输入框\n\n      this.chatRoom.input = \"\";\n    }\n  },\n  mounted: function mounted() {\n    var data = {\n      userName: this.userId\n    }; //初始化或者路由切换刷新\n\n    messageApi.freshMessage(data, this);\n  },\n  components: {\n    leftMsg: leftMsg,\n    rightMsg: rightMsg\n  }\n};",{"version":3,"sources":["messageMain.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA,OAAA,MAAA,MAAA,sBAAA;AACA,OAAA,UAAA,MAAA,kBAAA;AACA,OAAA,OAAA,MAAA,kCAAA;AACA,OAAA,QAAA,MAAA,mCAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,aADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA;AACA,MAAA,aAAA,EAAA,KADA;AAEA,MAAA,QAAA,EAAA,EAFA;AAGA,MAAA,QAAA,EAAA;AACA,QAAA,MAAA,EAAA,IADA;AAEA,QAAA,KAAA,EAAA,EAFA;AAGA,QAAA,IAAA,EAAA,EAHA;AAIA,QAAA,QAAA,EAAA;AAJA,OAHA;AASA,MAAA,MAAA,EAAA,cAAA,CAAA,OAAA,CAAA,QAAA;AATA,KAAA;AAWA,GAdA;AAeA,EAAA,OAAA,EAAA;AACA;AACA,IAAA,SAFA,uBAEA;AACA,UAAA,IAAA,GAAA;AACA,QAAA,QAAA,EAAA,KAAA;AADA,OAAA;AAGA,WAAA,aAAA,GAAA,CAAA,KAAA,aAAA;AACA,MAAA,UAAA,CAAA,YAAA,CAAA,IAAA,EAAA,IAAA;AACA,KARA;AASA;AACA,IAAA,SAVA,qBAUA,IAVA,EAUA;AACA;AACA,WAAA,QAAA,CAAA,QAAA,GAAA,IAAA,CAAA,UAAA,CAFA,CAGA;;AACA,UAAA,IAAA,GAAA;AACA,QAAA,UAAA,EAAA,IAAA,CAAA,UADA;AAEA,QAAA,QAAA,EAAA,KAAA;AAFA,OAAA,CAJA,CAQA;;AACA,MAAA,UAAA,CAAA,eAAA,CAAA,IAAA,EAAA,IAAA,EATA,CAUA;;AACA,MAAA,UAAA,CAAA,WAAA,CAAA;AAAA,QAAA,QAAA,EAAA,KAAA,MAAA;AAAA,QAAA,QAAA,EAAA;AAAA,OAAA,EAAA,IAAA;AACA,WAAA,QAAA,CAAA,MAAA,GAAA,CAAA,KAAA,QAAA,CAAA,MAAA;AACA,KAvBA;AAwBA,IAAA,SAxBA,uBAwBA;AACA;AACA,WAAA,QAAA,CAAA,IAAA,CAAA,MAAA,GAAA,CAAA;AACA,WAAA,QAAA,CAAA,MAAA,GAAA,CAAA,KAAA,QAAA,CAAA,MAAA,CAHA,CAIA;;AACA,MAAA,UAAA,CAAA,cAAA;AACA,KA9BA;AA+BA;AACA,IAAA,IAhCA,kBAgCA;AACA;AACA,UAAA,KAAA,QAAA,CAAA,KAAA,KAAA,EAAA,EAAA;AACA,aAAA,OAAA,CAAA;AACA,UAAA,IAAA,EAAA,SADA;AAEA,UAAA,OAAA,EAAA,SAFA;AAGA,UAAA,QAAA,EAAA;AAHA,SAAA;AAKA;AACA,OATA,CAUA;;;AACA,WAAA,QAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AACA,QAAA,SAAA,EAAA,UADA;AAEA,QAAA,OAAA,EAAA,KAAA,QAAA,CAAA;AAFA,OAAA;AAIA,UAAA,IAAA,GAAA;AACA,QAAA,GAAA,EAAA,KAAA,QAAA,CAAA,KADA;AAEA,QAAA,IAAA,EAAA,KAAA,QAAA,CAAA;AAFA,OAAA;AAIA,MAAA,UAAA,CAAA,QAAA,CAAA,IAAA,EAnBA,CAoBA;;AACA,WAAA,QAAA,CAAA,KAAA,GAAA,EAAA;AACA;AAtDA,GAfA;AAuEA,EAAA,OAvEA,qBAuEA;AACA,QAAA,IAAA,GAAA;AACA,MAAA,QAAA,EAAA,KAAA;AADA,KAAA,CADA,CAIA;;AACA,IAAA,UAAA,CAAA,YAAA,CAAA,IAAA,EAAA,IAAA;AACA,GA7EA;AA8EA,EAAA,UAAA,EAAA;AACA,IAAA,OAAA,EAAA,OADA;AAEA,IAAA,QAAA,EAAA;AAFA;AA9EA,CAAA","sourcesContent":["<template>\r\n  <div id=\"messageMain\">\r\n    <transition name=\"chat\">\r\n      <van-pull-refresh\r\n        v-model=\"refreshStatus\"\r\n        success-text=\"刷新成功\"\r\n        @refresh=\"myRefresh\"\r\n        v-if=\"chatRoom.noShow\"\r\n      >\r\n        <div class=\"msg-ab\">\r\n          <img src=\"../../static/img/n=4.jpg\" alt />\r\n        </div>\r\n        <div class=\"down\">\r\n          <div>优友の呼唤</div>\r\n        </div>\r\n        <van-divider content-position=\"center\">消息列表</van-divider>\r\n        <div\r\n          class=\"msg-list\"\r\n          v-for=\"(item, index) in userList\"\r\n          :key=\"index\"\r\n          @click=\"enterChat(item)\"\r\n        >\r\n          <img src=\"../../static/img/n=3.jpg\" alt />\r\n          <div class=\"user-des\">\r\n            <div class=\"top\">\r\n              <span>{{ item.friendName }}</span>\r\n              <span>{{ item.time }}</span>\r\n            </div>\r\n            <div class=\"top top-msg\">\r\n              <span>点击进入聊天室</span>\r\n              <span class=\"no-see\"></span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </van-pull-refresh>\r\n      <div class=\"chatRoomWarp\" v-else>\r\n        <van-button type=\"primary\" block @click=\"leaveChat\"\r\n          >点击返回</van-button\r\n        >\r\n        <div class=\"content\">\r\n          <component\r\n            v-for=\"(item, index) in chatRoom.list\"\r\n            :is=\"item.component\"\r\n            :key=\"index\"\r\n            :userId=\"userId\"\r\n            :friendName=\"chatRoom.userName\"\r\n            :msg=\"item.content\"\r\n          ></component>\r\n          <div class=\"bottom\">\r\n            <van-field v-model=\"chatRoom.input\" left-icon=\"edit\"></van-field>\r\n            <van-button type=\"primary\" @click=\"send\">发送</van-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </transition>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport config from \"@/config/config.json\";\r\nimport messageApi from \"@/api/message.js\";\r\nimport leftMsg from \"@/components/Message/leftMsg.vue\";\r\nimport rightMsg from \"@/components/Message/rightMsg.vue\";\r\n\r\nexport default {\r\n  name: \"messageMain\",\r\n  data() {\r\n    return {\r\n      refreshStatus: false,\r\n      userList: [],\r\n      chatRoom: {\r\n        noShow: true,\r\n        input: \"\",\r\n        list: [],\r\n        userName: \"\",\r\n      },\r\n      userId: sessionStorage.getItem(\"userId\"),\r\n    };\r\n  },\r\n  methods: {\r\n    //上拉刷新\r\n    myRefresh() {\r\n      let data = {\r\n        userName: this.userId,\r\n      };\r\n      this.refreshStatus = !this.refreshStatus;\r\n      messageApi.freshMessage(data, this);\r\n    },\r\n    //进入聊天框\r\n    enterChat(item) {\r\n      //记录用户\r\n      this.chatRoom.userName = item.friendName;\r\n      //生成数据\r\n      let data = {\r\n        friendName: item.friendName,\r\n        userName: this.userId,\r\n      };\r\n      //请求历史信息\r\n      messageApi.specificMessage(data, this);\r\n      //建立socket连接\r\n      messageApi.chatConnect({ username: this.userId, password: \"\" }, this);\r\n      this.chatRoom.noShow = !this.chatRoom.noShow;\r\n    },\r\n    leaveChat() {\r\n      //清空消息\r\n      this.chatRoom.list.length = 0;\r\n      this.chatRoom.noShow = !this.chatRoom.noShow;\r\n      //断开连接\r\n      messageApi.chatDisconnect();\r\n    },\r\n    //用户发送消息\r\n    send() {\r\n      //未输入信息拦截\r\n      if (this.chatRoom.input === \"\") {\r\n        this.$notify({\r\n          type: \"warning\",\r\n          message: \"未输入任何信息\",\r\n          duration: 500,\r\n        });\r\n        return;\r\n      }\r\n      //加入right组件\r\n      this.chatRoom.list.push({\r\n        component: \"rightMsg\",\r\n        content: this.chatRoom.input,\r\n      });\r\n      let data = {\r\n        msg: this.chatRoom.input,\r\n        user: this.chatRoom.userName,\r\n      };\r\n      messageApi.chatSend(data);\r\n      //清空输入框\r\n      this.chatRoom.input = \"\";\r\n    },\r\n  },\r\n  mounted() {\r\n    let data = {\r\n      userName: this.userId,\r\n    };\r\n    //初始化或者路由切换刷新\r\n    messageApi.freshMessage(data, this);\r\n  },\r\n  components: {\r\n    leftMsg,\r\n    rightMsg,\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n#messageMain {\r\n  .mag-nav {\r\n    padding: 0px 0px;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    .mag-nav-item {\r\n      text-align: center;\r\n      width: 80px;\r\n    }\r\n  }\r\n  .msg-ab {\r\n    padding: 20px 0;\r\n    border-bottom: 1px #242630 dotted;\r\n    img {\r\n      height: 120px;\r\n      width: 100%;\r\n      border-radius: 10px;\r\n    }\r\n  }\r\n  .down {\r\n    padding: 10px 0;\r\n    color: #536333;\r\n    font-weight: 600;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    /* border-bottom: 1px #242630 dotted; */\r\n  }\r\n  .msg-list {\r\n    display: flex;\r\n    padding: 10px 0;\r\n    margin-top: 30px;\r\n    img {\r\n      width: 50px;\r\n      height: 50px;\r\n      border-radius: 50%;\r\n    }\r\n  }\r\n  .user-des {\r\n    flex: 1;\r\n    height: 60px;\r\n    border-bottom: #d1d9e1 solid;\r\n    .top {\r\n      font-size: 14px;\r\n      margin-left: 10px;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      line-height: 25px;\r\n    }\r\n    .top-msg {\r\n      color: #666666;\r\n      align-items: center;\r\n      .no-see {\r\n        width: 8px;\r\n        height: 8px;\r\n        border-radius: 50%;\r\n        border: #face15;\r\n      }\r\n    }\r\n  }\r\n  .chatRoomWarp {\r\n    .content {\r\n      border: 2px solid rgb(209, 217, 225);\r\n    }\r\n    .bottom {\r\n      margin-top: 20px;\r\n      display: flex;\r\n      width: 100%;\r\n      border-top: 2px solid rgb(209, 217, 225);\r\n      .van-button {\r\n        width: 70px;\r\n      }\r\n      .van-field {\r\n        padding: 0 16px;\r\n        height: 44px;\r\n        line-height: 44px;\r\n      }\r\n    }\r\n  }\r\n  .chat-enter {\r\n    transform: translateY(50px);\r\n    opacity: 0;\r\n  }\r\n  .chat-enter-active {\r\n    transition: all 0.5s;\r\n  }\r\n}\r\n</style>"],"sourceRoot":"src/components/Message"}]}